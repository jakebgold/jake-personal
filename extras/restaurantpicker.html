<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Sophie Dinner</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">

    <script type='text/javascript' src='/Users/jake/Documents/Javascript/cuisinepicker/config.js'></script>


    <style>
        body {
            margin: 10%;
            font-family: 'Roboto', sans-serif;
        }

        #accCuisines {
            margin: 5%;
        }
    </style>

    <script>
        var key = config.SECRET_API_KEY;

        var cuisines = [
            'American',
            'Barbeque',
            'Chicken',
            'Chinese',
            'Dim Sum',
            'Diner Food',
            'Dumplings',
            'Eastern European',
            'French',
            'Greek',
            'Hamburgers',
            'Hawaiian',
            'Indian',
            'Italian',
            'Japanese/Ramen',
            'Korean',
            'Mediterranean',
            'Mexican',
            'Middle Eastern',
            'Pizza',
            'Ramen',
            'Salads',
            'Sandwiches',
            'Seafood',
            'Soul Food',
            'Soup',
            'Sushi',
            'Tacos',
            'Thai'
        ].sort((a, b) => 0.5 - Math.random());

        // var cuisines = ['Chinese', 'Chicken', 'Japanese'];

        var c = 0;
        var accCuisines = []


        var url = "https://api.airtable.com/v0/apprGsqAaYZdvrNR0/restaurants";
        var res = '';
        var xhr = new XMLHttpRequest();
        xhr.responseType = 'json';
        xhr.open("GET", url);

        header = "Bearer " + key;

        xhr.setRequestHeader("Authorization", header);


        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                res = xhr.response['records'];
            }
        };

        xhr.send();

        var resDict = {};
        var finDict = {};

        var getAllRestaurants = function () {
            for (item in res) {
                resDict[res[item]['fields']['name']] = res[item]['fields']['cuisines'];
            };

            for (item in resDict) {
                for (cuisine in resDict[item]) {
                    if (resDict[item][cuisine] in finDict) {
                        finDict[resDict[item][cuisine]].push(item);
                    } else {
                        finDict[resDict[item][cuisine]] = [item];
                    }
                }
            }
            return finDict;
        };

        var restaurantSuggestions = new Array;

        function getRightRestaurants(cuisines) {

            var allRestaurants = getAllRestaurants();
            for (i in cuisines) {
                var cuisine = cuisines[i]

                if (allRestaurants[cuisine] != undefined) {
                    restaurantSuggestions = restaurantSuggestions.concat(allRestaurants[cuisine]);
                }


            };
            return restaurantSuggestions;


        }

        var cuisineY = function () {
            accCuisines.push(cuisines[c])
            c += 1;
            document.getElementById("cuisine").innerHTML = cuisines[c];
            if (accCuisines.length > 2) {

                var posRest = getRightRestaurants(accCuisines);

                document.getElementById("accCuisines").innerHTML +=
                    'Sophie is in the mood for ... <br><br><ul><li>' +
                    accCuisines.join("</li><li>") +
                    '</li></ul><br>';

                if (posRest.length > 0) {
                    document.getElementById("accCuisines").innerHTML += "Some ideas might be ... <br><br><ul><li>" +
                        posRest.join("</li><li>") +
                        '</li></ul><br><br>';
                } else {
                    document.getElementById("accCuisines").innerHTML +=
                        "Afraid you don't have any favorite restaurants in these cuisines. Go try something new!";
                }

                document.getElementById("choices").style.display = 'none';

            };
        }
        var cuisineN = function () {
            c += 1;
            document.getElementById("cuisine").innerHTML = cuisines[c];
        }
    </script>

</head>

<body>
    <div id="choices">
        <h1>Does Sophie want <font id="cuisine" style="color: red;"></font> for dinner tonight?</h1>
        <button type="button" class="btn btn-success" onclick="cuisineY()">Yes!</button>
        <button type="button" class="btn btn-danger" onclick="cuisineN()">No.</button>
    </div>
    <script>
        document.getElementById("cuisine").innerHTML = cuisines[0];
    </script>

    <p id='accCuisines'></p>

</body>